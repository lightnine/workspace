# 初步设计文档
你要从零实现一个类似 Databricks Workspace 的系统，用 Go 实现完整的后端（HTTP 服务 + 数据存储 + 用户 & 权限管理等）。

## 一、系统背景
Workspace 是一个支持数据工程、分析和协作开发的在线工作区平台。它提供用户可以上传/编辑/管理代码、Notebook、文件、目录结构，支持权限控制、协作管理以及搜索等功能。这个系统需要具备类 Databricks Workspace 的基本能力（对象浏览、文件编辑与存储、协作与权限、版本控制基础等）。

## 二、核心功能模块

### 1. 目录 & 对象管理
- 支持创建、删除、重命名、移动目录
- 支持上传、下载、删除、重命名文件（Notebook / .py / .sql / Markdown / 配置文件等）
- 提供对象浏览（返回目录树结构），支持分页 & 过滤
- 每个对象应有唯一 ID 与元信息（创建者、创建时间、修改时间等）

### 2. 文件编辑与存储
- 支持在线编辑文档内容
- 支持保存版本快照（简化版版本控制）
- 支持文件内容读取与写入
- 支持存储元数据（大小、类型、路径）

### 3. 搜索与筛选
- 支持按名称 / 类型 /标签 搜索对象
- 支持在对象内容中搜索关键字

### 4. 用户 & 权限管理
- 用户注册、登录、Token 认证
- 权限控制层级：Owner / Editor / Viewer
- 文件/目录可设置访问权限（继承父目录权限）
- 访问控制检查中间件

### 5. 协作功能（暂时先不实现）
- 多用户可同时操作（版本冲突检查与提示）
- 注释与讨论（可选）

### 6. API 规范
- 所有功能需通过 REST API 提供
- 文档采用 OpenAPI / Swagger
- 返回统一 JSON 格式

## 三、技术栈与实现约束
- 语言: **Go**
- HTTP 框架: Gin
- 数据库框架：Gorm
- 数据库用：Postgresql
- 文件存储：存储到本地文件系统
- 认证: JWT
- 日志/错误: 必须有完整日志 & 错误处理，日志采用Zap或者zerolog，你自己决定用哪种
- 测试: 单元测试 + API 自动测试
- API 文档: 生成 Swagger/OpenAPI 文件
- 配置文件需要支持热加载，比如采用viper

### 设计要求
- 需要采用整洁架构去实现
- 需要保证go代码符合go格式化要求
- 文件id用juicefs的inode

### 其他
我当前将文件存储到本地目录，这个目录是juicefs进行挂载的。所以这个目录应该写到配置文件中，可以进行配置。juicefs底层原理是元数据保存到数据库，文件内容保存到对象存储。juicefs是进行FUSE的。所以我们可以像操作本地文件一样去操作juicefs。所以类似创建文件、移动文件等等操作都可以直接使用linux命令进行。
但是考虑到我们这里有一些其他的信息，比如需要记录当前文件的创建人等一些业务信息，我们仍然需要再数据库中自己记录。

## 五、预期交付内容
1. Go 代码库
2. 单元测试 & 集成测试
3. 数据库模型
4. REST API 文档
5. 使用示例（curl / Postman）

请从系统设计、接口定义、数据库建模开始，再生成完整实现代码，并注释解释每个模块。
